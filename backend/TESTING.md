# Go åç«¯æµ‹è¯•æ–‡æ¡£

## ğŸ§ª æµ‹è¯•æ¡†æ¶æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ Go æ ‡å‡†æµ‹è¯•æ¡†æ¶ `testing` åŒ…ï¼Œé…åˆ `httptest` è¿›è¡Œ HTTP è¯·æ±‚æ¨¡æ‹Ÿæµ‹è¯•ã€‚

### æµ‹è¯•ä¾èµ–

```go
import (
    "net/http"
    "net/http/httptest"
    "testing"
    "encoding/json"
    "bytes"
    
    "github.com/gin-gonic/gin"
    "github.com/stretchr/testify/assert"
    "github.com/stretchr/testify/mock"
)
```

## ğŸ“ æµ‹è¯•æ–‡ä»¶ç»“æ„

```
backend/
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ auth_controller_test.go      # è®¤è¯æ§åˆ¶å™¨æµ‹è¯•
â”‚   â”œâ”€â”€ home_controller_test.go      # é¦–é¡µæ§åˆ¶å™¨æµ‹è¯•
â”‚   â”œâ”€â”€ detail_controller_test.go    # è¯¦æƒ…æ§åˆ¶å™¨æµ‹è¯•
â”‚   â”œâ”€â”€ training_controller_test.go  # è®­ç»ƒæ§åˆ¶å™¨æµ‹è¯•
â”‚   â”œâ”€â”€ community_controller_test.go # ç¤¾åŒºæ§åˆ¶å™¨æµ‹è¯•
â”‚   â”œâ”€â”€ integration_test.go          # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ test_helpers.go              # æµ‹è¯•è¾…åŠ©å‡½æ•°
â”œâ”€â”€ config/
â”‚   â””â”€â”€ test_config.go               # æµ‹è¯•é…ç½®
â””â”€â”€ run_tests.sh                     # æµ‹è¯•è¿è¡Œè„šæœ¬
```

## ğŸ”¬ å•å…ƒæµ‹è¯•

### 1. è®¤è¯æ¥å£æµ‹è¯•

#### ç”¨æˆ·ç™»å½•æµ‹è¯•
```go
func TestLogin(t *testing.T) {
    // æµ‹è¯•æ­£å¸¸ç™»å½•
    // æµ‹è¯•æ— æ•ˆé‚®ç®±æ ¼å¼
    // æµ‹è¯•å¯†ç å¤ªçŸ­
    // æµ‹è¯•ç©ºè¯·æ±‚ä½“
}
```

#### ç”¨æˆ·æ³¨å†Œæµ‹è¯•
```go
func TestRegister(t *testing.T) {
    // æµ‹è¯•æ­£å¸¸æ³¨å†Œ
    // æµ‹è¯•ç”¨æˆ·åå¤ªçŸ­
    // æµ‹è¯•æ— æ•ˆé‚®ç®±æ ¼å¼
    // æµ‹è¯•å¯†ç å¤ªçŸ­
}
```

### 2. é¦–é¡µæ¥å£æµ‹è¯•

#### è·å–é¦–é¡µåˆ—è¡¨æµ‹è¯•
```go
func TestGetHomeList(t *testing.T) {
    // æµ‹è¯•æ­£å¸¸è·å–åˆ—è¡¨
    // æµ‹è¯•å¸¦ç­›é€‰æ¡ä»¶çš„åˆ—è¡¨
    // æµ‹è¯•æ— æ•ˆåˆ†é¡µå‚æ•°
}
```

#### æ–°å¢é¦–é¡µé¡¹æµ‹è¯•
```go
func TestAddHomeItem(t *testing.T) {
    // æµ‹è¯•æ­£å¸¸æ–°å¢é¡¹ç›®
    // æµ‹è¯•ç¼ºå°‘å¿…å¡«å­—æ®µ
    // æµ‹è¯•ç©ºè¯·æ±‚ä½“
}
```

### 3. è¯¦æƒ…æ¥å£æµ‹è¯•

#### è·å–è¯¦æƒ…åˆ—è¡¨æµ‹è¯•
```go
func TestGetDetailList(t *testing.T) {
    // æµ‹è¯•æ­£å¸¸è·å–è¯¦æƒ…åˆ—è¡¨
    // æµ‹è¯•å¸¦ç±»å‹ç­›é€‰
    // æµ‹è¯•å¸¦å…³é”®è¯æœç´¢
}
```

#### æäº¤è¯¦æƒ…æµ‹è¯•
```go
func TestSubmitDetail(t *testing.T) {
    // æµ‹è¯•æ­£å¸¸æäº¤è¯¦æƒ…
    // æµ‹è¯•ç¼ºå°‘å¿…å¡«å­—æ®µ
    // æµ‹è¯•ç©ºè¯·æ±‚ä½“
}
```

### 4. è®­ç»ƒæ¥å£æµ‹è¯•

#### è·å–è®­ç»ƒè®¡åˆ’æµ‹è¯•
```go
func TestGetTrainingPlans(t *testing.T) {
    // æµ‹è¯•æ­£å¸¸è·å–è®­ç»ƒè®¡åˆ’
    // æµ‹è¯•é»˜è®¤å‚æ•°
    // æµ‹è¯•æ— æ•ˆåˆ†é¡µå‚æ•°
}
```

#### åˆ›å»ºè®­ç»ƒè®¡åˆ’æµ‹è¯•
```go
func TestCreateTrainingPlan(t *testing.T) {
    // æµ‹è¯•æ­£å¸¸åˆ›å»ºè®­ç»ƒè®¡åˆ’
    // æµ‹è¯•ç¼ºå°‘å¿…å¡«å­—æ®µ
    // æµ‹è¯•ç©ºè¯·æ±‚ä½“
}
```

### 5. ç¤¾åŒºæ¥å£æµ‹è¯•

#### è·å–å¸–å­åˆ—è¡¨æµ‹è¯•
```go
func TestGetPosts(t *testing.T) {
    // æµ‹è¯•æ­£å¸¸è·å–å¸–å­åˆ—è¡¨
    // æµ‹è¯•å¸¦ç±»å‹ç­›é€‰
    // æµ‹è¯•å¸¦å…³é”®è¯æœç´¢
}
```

#### åˆ›å»ºå¸–å­æµ‹è¯•
```go
func TestCreatePost(t *testing.T) {
    // æµ‹è¯•æ­£å¸¸åˆ›å»ºæ–‡æœ¬å¸–å­
    // æµ‹è¯•æ­£å¸¸åˆ›å»ºå›¾ç‰‡å¸–å­
    // æµ‹è¯•ç¼ºå°‘å¿…å¡«å­—æ®µ
    // æµ‹è¯•å†…å®¹å¤ªé•¿
}
```

## ğŸ”— é›†æˆæµ‹è¯•

### ç”¨æˆ·æ³¨å†Œç™»å½•æµç¨‹æµ‹è¯•
```go
func TestIntegration(t *testing.T) {
    // 1. æ³¨å†Œç”¨æˆ·
    // 2. ç™»å½•ç”¨æˆ·
    // 3. éªŒè¯token
}
```

### è®­ç»ƒè®¡åˆ’åˆ›å»ºå’Œä½¿ç”¨æµç¨‹æµ‹è¯•
```go
func TestTrainingPlanFlow(t *testing.T) {
    // 1. åˆ›å»ºè®­ç»ƒè®¡åˆ’
    // 2. è·å–è®­ç»ƒè®¡åˆ’åˆ—è¡¨
    // 3. å¼€å§‹è®­ç»ƒä¼šè¯
    // 4. æ›´æ–°è®­ç»ƒè¿›åº¦
    // 5. å®Œæˆè®­ç»ƒä¼šè¯
}
```

### ç¤¾åŒºå¸–å­åˆ›å»ºå’Œäº’åŠ¨æµç¨‹æµ‹è¯•
```go
func TestCommunityFlow(t *testing.T) {
    // 1. åˆ›å»ºå¸–å­
    // 2. è·å–å¸–å­åˆ—è¡¨
    // 3. ç‚¹èµå¸–å­
    // 4. æ·»åŠ è¯„è®º
    // 5. åˆ é™¤è¯„è®º
}
```

## ğŸ› ï¸ æµ‹è¯•è¾…åŠ©å‡½æ•°

### æµ‹è¯•ç¯å¢ƒè®¾ç½®
```go
func TestMain(m *testing.M) {
    // è®¾ç½®æµ‹è¯•ç¯å¢ƒå˜é‡
    // åˆå§‹åŒ–æµ‹è¯•æ•°æ®åº“
    // è¿è¡Œæµ‹è¯•
    // æ¸…ç†èµ„æº
}
```

### æµ‹è¯•è·¯ç”±è®¾ç½®
```go
func setupTestRouter() *gin.Engine {
    // åˆ›å»ºæµ‹è¯•è·¯ç”±
    // æ³¨å†Œæ‰€æœ‰æµ‹è¯•ç«¯ç‚¹
    // è¿”å›è·¯ç”±å®ä¾‹
}
```

### æµ‹è¯•æ•°æ®åˆ›å»º
```go
func createTestUser() *models.User
func createTestHomeItem() *models.HomeItem
func createTestDetailItem() *models.DetailItem
func createTestPost() *models.Post
func createTestTrainingPlan() *models.TrainingPlan
```

## ğŸš€ è¿è¡Œæµ‹è¯•

### 1. è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
cd backend
./run_tests.sh
```

### 2. è¿è¡Œå•å…ƒæµ‹è¯•
```bash
go test ./controllers -v
```

### 3. è¿è¡Œé›†æˆæµ‹è¯•
```bash
go test ./controllers -v -run TestIntegration
```

### 4. è¿è¡Œæ€§èƒ½æµ‹è¯•
```bash
go test ./controllers -v -bench=. -benchmem
```

### 5. è¿è¡Œç«æ€æ£€æµ‹
```bash
go test ./controllers -v -race
```

### 6. ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```bash
go test ./... -v -cover -coverprofile=coverage.out
go tool cover -html=coverage.out -o coverage.html
```

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡

### è¦†ç›–ç‡ç›®æ ‡
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡: â‰¥ 80%
- é›†æˆæµ‹è¯•è¦†ç›–ç‡: â‰¥ 70%
- æ•´ä½“æµ‹è¯•è¦†ç›–ç‡: â‰¥ 75%

### è¦†ç›–ç‡æŠ¥å‘Š
```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
go test ./... -cover -coverprofile=coverage.out

# æŸ¥çœ‹è¦†ç›–ç‡ç»Ÿè®¡
go tool cover -func=coverage.out

# ç”ŸæˆHTMLæŠ¥å‘Š
go tool cover -html=coverage.out -o coverage.html
```

## ğŸ” æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•å‘½å
- æµ‹è¯•å‡½æ•°åä»¥ `Test` å¼€å¤´
- æµ‹è¯•ç”¨ä¾‹åæè¿°æµ‹è¯•åœºæ™¯
- ä½¿ç”¨ `t.Run()` ç»„ç»‡å­æµ‹è¯•

### 2. æµ‹è¯•æ•°æ®
- ä½¿ç”¨å†…å­˜æ•°æ®åº“è¿›è¡Œæµ‹è¯•
- æ¯ä¸ªæµ‹è¯•ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®
- æµ‹è¯•åæ¸…ç†æµ‹è¯•æ•°æ®

### 3. é”™è¯¯å¤„ç†
- æµ‹è¯•å„ç§é”™è¯¯æƒ…å†µ
- éªŒè¯é”™è¯¯å“åº”æ ¼å¼
- æ£€æŸ¥é”™è¯¯çŠ¶æ€ç 

### 4. æ€§èƒ½æµ‹è¯•
- ä½¿ç”¨ `testing.B` è¿›è¡Œæ€§èƒ½æµ‹è¯•
- æµ‹è¯•å¹¶å‘å®‰å…¨æ€§
- ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ

## ğŸ› è°ƒè¯•æµ‹è¯•

### 1. è¯¦ç»†è¾“å‡º
```bash
go test -v ./controllers
```

### 2. å•ä¸ªæµ‹è¯•
```bash
go test -v -run TestLogin ./controllers
```

### 3. æµ‹è¯•è¶…æ—¶
```bash
go test -timeout 30s ./controllers
```

### 4. å¹¶è¡Œæµ‹è¯•
```bash
go test -parallel 4 ./controllers
```

## ğŸ“ˆ æŒç»­é›†æˆ

### GitHub Actions é…ç½®
```yaml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-go@v2
        with:
          go-version: 1.21
      - run: go test ./... -v -cover
```

## ğŸ¯ æµ‹è¯•ç­–ç•¥

### 1. æµ‹è¯•é‡‘å­—å¡”
- å•å…ƒæµ‹è¯• (70%)
- é›†æˆæµ‹è¯• (20%)
- ç«¯åˆ°ç«¯æµ‹è¯• (10%)

### 2. æµ‹è¯•ä¼˜å…ˆçº§
1. æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
2. APIæ¥å£
3. æ•°æ®åº“æ“ä½œ
4. é”™è¯¯å¤„ç†
5. æ€§èƒ½å…³é”®è·¯å¾„

### 3. æµ‹è¯•ç»´æŠ¤
- å®šæœŸæ›´æ–°æµ‹è¯•ç”¨ä¾‹
- ä¿æŒæµ‹è¯•ä»£ç ç®€æ´
- åŠæ—¶ä¿®å¤å¤±è´¥çš„æµ‹è¯•
- ç›‘æ§æµ‹è¯•è¦†ç›–ç‡å˜åŒ–
